# SUSTech_CS207_Project
电子琴学习机
这是2023秋季学期数字逻辑project，理论课是白雨卉老师，lab课是王薇老师（喜欢两位老师捏）

成员
> 黄奕凡
> 黄筱津
> 吴卓轩

分数：未知/100

## 项目框架
### 功能列表流程图
![流程图](https://github.com/HelloFiona6/SUSTech_CS207_Project-Piano-/assets/131880624/3dc50d3c-bf1e-44e5-986e-e8a55d778efe)

### 项目框架示意图
![image](https://github.com/HelloFiona6/SUSTech_CS207_Project-Piano-/assets/131880624/45c7c002-428f-4b34-8ef4-5324959f4d1a)

### 模式说明
1. 用户登录
* 在刚打开开发板时，会进入用户登录模式，总共有8个不同用户可供选择。
* 此时数码管上会显示用户名称及其挑战模式的分数与评级。
* 选择用户后，在挑战模式中会随着用户的演奏评分更新用户的评级。

2. 自由演奏模式
* 进入模式，数码管会显示“FREEPLAY”字样
* 在未经过调整模式调整按键的情况下，可以从左往右弹出do,re,mi,fa,so,la,si七个音，并实现三个八度的自由切换。
* 每个音符发声的同时，琴键上方的led会亮起。
* 如果想要录音，将录音按键打开后便会进入录音模式，记录用户演奏内容，录音按键关闭后则结束录音，且录音可以在自动演奏模式，学习模式，挑战模式播放，并且新的录音文件能够自动覆盖先前的。
* 如果在调整模式中根据用户喜好调整按键位置，那么当用户回到自由演奏模式中音符则会按照调整过的顺序演奏。

3. 自动演奏模式
* 调整到自动演奏模式之后，会进入选曲模式中。此时，用户可以通过开发板右侧左右按键（V1, R11）选择要播放的曲子。
* 每移动到一首曲子，数码管就会显示这首歌曲的名称缩写及其编号。如果移动到自由模式录制的曲子时，数码管会显示对应的序号。
* 在按下开发板右侧中间按键（R15）确定曲目后，开始播放对应选曲的音乐，每一个音符播放的同时，对应的音符的led也会亮起。
* 播放曲子时，每个音符之间会有小的停顿，提升听歌体验。
* 曲库内有4首默认曲子：江南，生日快乐，圣诞快乐，小星星。在数码管上分别显示为：JN, HB, CR, TS。
* 曲库内还可以保存1首用户录制弹奏的曲子。

4. 学习模式
* 调整到学习模式之后，会进入选曲模式中。此时，用户可以通过开发板右侧左右按键（V1, R11）选择要播放的曲子。
* 按下确认键后则开始进入学习模式，根据要弹奏的内容琴键上方的led灯会亮起。用户正确按下对应的琴键后，这个led灯会熄灭，下一个音符对应的led灯会亮起。
* 声音会随着用户的演奏响起。
* 数码管会显示所选择的曲目、当前的失误数和基于失误数的评级，失误数与评级提供实时反馈。学习模式的评分标准是挑战模式的弱化版。
* 学习模式的评级不会记录到账户中。

5. 挑战模式
* 相比于学习模式，挑战模式不会等待用户按下对应的琴键，而是以一定速度亮起每个音符的led，用户需要在灯灭之前弹奏对应的琴键。
* 可以选择难度，共有三个难度等级，不同等级曲子播放的速度不同，挑战难度随之改变。
* 调整到挑战模式之后，会进入选曲模式中。此时，用户可以通过开发板右侧左右按键（V1, R11）选择要播放的曲子。
* 确认选曲后，数码管会显示“3、2、1、START”的倒计时，倒计时结束后挑战开始。
* 开始挑战后，会亮起两个led灯，一个正常亮的是当前需要弹奏的音符，另一个快速闪烁的是下一个需要弹奏的音符，方便玩家提前准备。数码管会显示所选择的曲目、当前的失误数和基于失误数的评级，失误数与评级提供实时反馈。
* 用户按下琴键以后，声音才会发出。
* 挑战模式的评级会根据不同评级与难度，转换为分数记录到账户的积分中。

6. 调整模式
* 用户可以根据他们的使用习惯调整键的位置，当学习设备进入调整模式时，设备按顺序演奏音符。
* 此时数码管会显示“ADJUST”字样。
* 每演奏一个音符，对应的led灯都会亮起。
* 当用户选择完音符相对应的按键，按下确认按钮（R16）后，则会跳到下一个音。
* 可以设置三个八度的按键，设置完以后，新的按键模式可以在各种模式中使用。

### bonus 实现说明
1. 新增了挑战模式，能够实现不同挑战难度的选择，共有三个难度(EASY、NORMOL、DIFFICULT)可以选择，并且能通过错误数进行评级，最终的评级可以转化为分数加到用户的账户积分中。
2. 用户可以根据他们的使用习惯调整键的位置：实现了调整模式。进入调整模式时，设备按音符的1234567顺序演奏音符。选择与在响的音符相对应的按键后，按下确认按钮，机器将演奏下一个音符，等待用户再次选择并确认。完成所有确认后，用户练习期间按下的键对应的音符将与调整模式一致。
3. 实现了录音模式。进入录音模式，记录用户按下的键的顺序和位置并记录持续时间, 当用户退出录音模式或录音记录到存储上限后，能将其保存在设备中，以后可以通过自动播放模式重新播放它，并且在学习模式和挑战模式中可以选择录音的歌曲来学习和游玩。新的录音能够覆盖当前存储的录音。
4. 学习模式、自动演奏模式、挑战模式可以显示当前选择的曲目名缩写与歌曲编号。挑战模式游戏开始前有3、2、1、start的提示显示。此外学习模式和挑战模式，都有下一个音符的led演奏提示（闪烁的led灯）。
5. 关于评分的实时更新更加精细和合理： 在学习模式和挑战模式中，能够根据用户按键的时间与标准时间的差异记录用户的失误次数，根据失误数进行演奏评级(分为A/B/C/D/E五个等级)，挑战模式的评级可以化为账户的积分，并能根据积分获得总评级。
6. 音乐的节奏更多变化： 在自动模式和学习模式中，每个音符的持续时间可以不一致。利用每个音符利用7bits来存储,前2个bit存储音符的持续时间，后5个bit存储音符本身。
7. 自动演奏模式速度切换：在曲子开始播放以后，可以通过左右键实现倍速播放，依次来实时控制播放速度。
